(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{129:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return s})),n.d(t,"rightToc",(function(){return i})),n.d(t,"default",(function(){return d}));var r=n(2),a=n(6),o=(n(0),n(149)),c={id:"writing-tests",title:"Writing Tests",hide_title:!0},s={unversionedId:"recipes/writing-tests",id:"recipes/writing-tests",isDocsHomePage:!1,title:"Writing Tests",description:"Writing Tests",source:"@site/../docs_kr/recipes/WritingTests.md",slug:"/recipes/writing-tests",permalink:"/recipes/writing-tests",version:"current",sidebar:"docs",previous:{title:"Server Rendering",permalink:"/recipes/server-rendering"},next:{title:"Computing Derived Data",permalink:"/recipes/computing-derived-data"}},i=[{value:"Setting Up",id:"setting-up",children:[]},{value:"Action Creators",id:"action-creators",children:[]},{value:"Async Action Creators",id:"async-action-creators",children:[]},{value:"Reducers",id:"reducers",children:[]},{value:"Components",id:"components",children:[]},{value:"Connected Components",id:"connected-components",children:[]},{value:"Middleware",id:"middleware",children:[]},{value:"Glossary",id:"glossary",children:[]}],p={rightToc:i};function d(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"writing-tests"},"Writing Tests"),Object(o.b)("p",null,"Because most of the Redux code you write are functions, and many of them are pure, they are easy to test without mocking."),Object(o.b)("h3",{id:"setting-up"},"Setting Up"),Object(o.b)("p",null,"We recommend ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"http://facebook.github.io/jest/"}),"Jest")," as the testing engine.\nNote that it runs in a Node environment, so you won't have access to the DOM."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"npm install --save-dev jest\n")),Object(o.b)("p",null,"To use it together with ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"http://babeljs.io"}),"Babel"),", you will need to install ",Object(o.b)("inlineCode",{parentName:"p"},"babel-jest"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"npm install --save-dev babel-jest\n")),Object(o.b)("p",null,"and configure it to use ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/babel/babel/tree/master/packages/babel-preset-env"}),"babel-preset-env")," features in ",Object(o.b)("inlineCode",{parentName:"p"},".babelrc"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),'{\n  "presets": ["@babel/preset-env"]\n}\n')),Object(o.b)("p",null,"Then, add this to ",Object(o.b)("inlineCode",{parentName:"p"},"scripts")," in your ",Object(o.b)("inlineCode",{parentName:"p"},"package.json"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),'{\n  ...\n  "scripts": {\n    ...\n    "test": "jest",\n    "test:watch": "npm test -- --watch"\n  },\n  ...\n}\n')),Object(o.b)("p",null,"and run ",Object(o.b)("inlineCode",{parentName:"p"},"npm test")," to run it once, or ",Object(o.b)("inlineCode",{parentName:"p"},"npm run test:watch")," to test on every file change."),Object(o.b)("h3",{id:"action-creators"},"Action Creators"),Object(o.b)("p",null,"In Redux, action creators are functions which return plain objects. When testing action creators, we want to test whether the correct action creator was called and also whether the right action was returned."),Object(o.b)("h4",{id:"example"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"export function addTodo(text) {\n  return {\n    type: 'ADD_TODO',\n    text\n  }\n}\n")),Object(o.b)("p",null,"can be tested like:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import * as actions from '../../actions/TodoActions'\nimport * as types from '../../constants/ActionTypes'\n\ndescribe('actions', () => {\n  it('should create an action to add a todo', () => {\n    const text = 'Finish docs'\n    const expectedAction = {\n      type: types.ADD_TODO,\n      text\n    }\n    expect(actions.addTodo(text)).toEqual(expectedAction)\n  })\n})\n")),Object(o.b)("h3",{id:"async-action-creators"},"Async Action Creators"),Object(o.b)("p",null,"For async action creators using ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/gaearon/redux-thunk"}),"Redux Thunk")," or other middleware, it's best to completely mock the Redux store for tests. You can apply the middleware to a mock store using ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/arnaudbenard/redux-mock-store"}),"redux-mock-store"),". You can also use ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"http://www.wheresrhys.co.uk/fetch-mock/"}),"fetch-mock")," to mock the HTTP requests."),Object(o.b)("h4",{id:"example-1"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import 'cross-fetch/polyfill'\n\nfunction fetchTodosRequest() {\n  return {\n    type: FETCH_TODOS_REQUEST\n  }\n}\n\nfunction fetchTodosSuccess(body) {\n  return {\n    type: FETCH_TODOS_SUCCESS,\n    body\n  }\n}\n\nfunction fetchTodosFailure(ex) {\n  return {\n    type: FETCH_TODOS_FAILURE,\n    ex\n  }\n}\n\nexport function fetchTodos() {\n  return dispatch => {\n    dispatch(fetchTodosRequest())\n    return fetch('http://example.com/todos')\n      .then(res => res.json())\n      .then(body => dispatch(fetchTodosSuccess(body)))\n      .catch(ex => dispatch(fetchTodosFailure(ex)))\n  }\n}\n")),Object(o.b)("p",null,"can be tested like:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import configureMockStore from 'redux-mock-store'\nimport thunk from 'redux-thunk'\nimport * as actions from '../../actions/TodoActions'\nimport * as types from '../../constants/ActionTypes'\nimport fetchMock from 'fetch-mock'\nimport expect from 'expect' // You can use any testing library\n\nconst middlewares = [thunk]\nconst mockStore = configureMockStore(middlewares)\n\ndescribe('async actions', () => {\n  afterEach(() => {\n    fetchMock.restore()\n  })\n\n  it('creates FETCH_TODOS_SUCCESS when fetching todos has been done', () => {\n    fetchMock.getOnce('/todos', {\n      body: { todos: ['do something'] },\n      headers: { 'content-type': 'application/json' }\n    })\n\n    const expectedActions = [\n      { type: types.FETCH_TODOS_REQUEST },\n      { type: types.FETCH_TODOS_SUCCESS, body: { todos: ['do something'] } }\n    ]\n    const store = mockStore({ todos: [] })\n\n    return store.dispatch(actions.fetchTodos()).then(() => {\n      // return of async actions\n      expect(store.getActions()).toEqual(expectedActions)\n    })\n  })\n})\n")),Object(o.b)("h3",{id:"reducers"},"Reducers"),Object(o.b)("p",null,"A reducer should return the new state after applying the action to the previous state, and that's the behavior tested below."),Object(o.b)("h4",{id:"example-2"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import { ADD_TODO } from '../constants/ActionTypes'\n\nconst initialState = [\n  {\n    text: 'Use Redux',\n    completed: false,\n    id: 0\n  }\n]\n\nexport default function todos(state = initialState, action) {\n  switch (action.type) {\n    case ADD_TODO:\n      return [\n        {\n          id: state.reduce((maxId, todo) => Math.max(todo.id, maxId), -1) + 1,\n          completed: false,\n          text: action.text\n        },\n        ...state\n      ]\n\n    default:\n      return state\n  }\n}\n")),Object(o.b)("p",null,"can be tested like:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import reducer from '../../structuring-reducers/todos'\nimport * as types from '../../constants/ActionTypes'\n\ndescribe('todos reducer', () => {\n  it('should return the initial state', () => {\n    expect(reducer(undefined, {})).toEqual([\n      {\n        text: 'Use Redux',\n        completed: false,\n        id: 0\n      }\n    ])\n  })\n\n  it('should handle ADD_TODO', () => {\n    expect(\n      reducer([], {\n        type: types.ADD_TODO,\n        text: 'Run the tests'\n      })\n    ).toEqual([\n      {\n        text: 'Run the tests',\n        completed: false,\n        id: 0\n      }\n    ])\n\n    expect(\n      reducer(\n        [\n          {\n            text: 'Use Redux',\n            completed: false,\n            id: 0\n          }\n        ],\n        {\n          type: types.ADD_TODO,\n          text: 'Run the tests'\n        }\n      )\n    ).toEqual([\n      {\n        text: 'Run the tests',\n        completed: false,\n        id: 1\n      },\n      {\n        text: 'Use Redux',\n        completed: false,\n        id: 0\n      }\n    ])\n  })\n})\n")),Object(o.b)("h3",{id:"components"},"Components"),Object(o.b)("p",null,"A nice thing about React components is that they are usually small and only rely on their props. That makes them easy to test."),Object(o.b)("p",null,"First, we will install ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://testing-library.com/docs/react-testing-library/intro"}),"React Testing Library"),". React Testing Library is a simple and complete React DOM testing utilities that encourage good testing practices. It uses react-dom's ",Object(o.b)("inlineCode",{parentName:"p"},"render")," function and ",Object(o.b)("inlineCode",{parentName:"p"},"act")," from react-dom/tests-utils."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"npm install --save-dev @testing-library/react\n")),Object(o.b)("p",null,"If you are using jest as recommended above, we also recommend installing ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/testing-library/jest-dom"}),"jest-dom")," as it provides a set of custom jest matchers that you can use to extend jest. These will make your tests more declarative, clear to read and to maintain. jest-dom is being used in the examples below."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"npm install --save-dev @testing-library/jest-dom\n")),Object(o.b)("p",null,"To test the components, we ",Object(o.b)("inlineCode",{parentName:"p"},"render")," them into the DOM and pass stubbed callbacks as props, then we assert whether the callbacks were called when expected."),Object(o.b)("h4",{id:"example-3"},"Example"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import React from 'react'\nimport PropTypes from 'prop-types'\nimport TodoTextInput from './TodoTextInput'\n\nconst Header = ({ addTodo }) => {\n  const handleSave = text => {\n    if (text.length !== 0) {\n      addTodo(text)\n    }\n  }\n\n  return (\n    <header className=\"header\">\n      <h1>todos</h1>\n      <TodoTextInput\n        newTodo={true}\n        onSave={handleSave}\n        placeholder=\"What needs to be done?\"\n      />\n    </header>\n  )\n}\n\nHeader.propTypes = {\n  addTodo: PropTypes.func.isRequired\n}\n\nexport default Header\n")),Object(o.b)("p",null,"can be tested like:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import React from 'react'\nimport { render, fireEvent, screen } from '@testing-library/react'\nimport Header from '../../components/Header'\n\nit('should not call addTodo if length of text is 0', () => {\n  const mockAddTodo = jest.fn()\n  render(<Header addTodo={mockAddTodo} />)\n\n  fireEvent.change(screen.getByPlaceholderText(/what needs to be done/i), {\n    target: { value: '' }\n  })\n\n  expect(mockAddTodo).toHaveBeenCalledTimes(0)\n})\n\nit('should call addTodo if length of text is greater than 0', () => {\n  const mockAddTodo = jest.fn()\n  render(<Header addTodo={mockAddTodo} />)\n\n  fireEvent.change(screen.getByPlaceholderText(/what needs to be done/i), {\n    target: { value: 'Use Redux' }\n  })\n\n  expect(mockAddTodo).toHaveBeenCalledTimes(1)\n})\n")),Object(o.b)("h3",{id:"connected-components"},"Connected Components"),Object(o.b)("p",null,"If you use a library like ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/reduxjs/react-redux"}),"React Redux"),", you might be using ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://medium.com/@dan_abramov/mixins-are-dead-long-live-higher-order-components-94a0d2f9e750"}),"higher-order components")," like ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://react-redux.js.org/api/connect"}),Object(o.b)("inlineCode",{parentName:"a"},"connect()")),". This lets you inject Redux state into a regular React component."),Object(o.b)("p",null,"Consider the following ",Object(o.b)("inlineCode",{parentName:"p"},"App")," component:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import { connect } from 'react-redux'\n\nconst App = props => {\n  return <div>{props.user}</div>\n}\n\nconst mapStateToProps = state => {\n  return state\n}\n\nexport default connect(mapStateToProps)(App)\n")),Object(o.b)("p",null,"To test it, we can use the ",Object(o.b)("inlineCode",{parentName:"p"},"wrapper")," option in React Testing Library's ",Object(o.b)("inlineCode",{parentName:"p"},"render")," function and export our own ",Object(o.b)("inlineCode",{parentName:"p"},"render")," function as explained in React Testing Library's ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://testing-library.com/docs/react-testing-library/setup"}),"setup docs"),"."),Object(o.b)("p",null,"Our ",Object(o.b)("inlineCode",{parentName:"p"},"render")," function can look like this:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// test-utils.js\nimport React from 'react'\nimport { render as rtlRender } from '@testing-library/react'\nimport { createStore } from 'redux'\nimport { Provider } from 'react-redux'\n// Import your own reducer\nimport reducer from '../reducer'\n\nfunction render(\n  ui,\n  {\n    initialState,\n    store = createStore(reducer, initialState),\n    ...renderOptions\n  } = {}\n) {\n  function Wrapper({ children }) {\n    return <Provider store={store}>{children}</Provider>\n  }\n  return rtlRender(ui, { wrapper: Wrapper, ...renderOptions })\n}\n\n// re-export everything\nexport * from '@testing-library/react'\n// override render method\nexport { render }\n")),Object(o.b)("p",null,"And our test can use our exported ",Object(o.b)("inlineCode",{parentName:"p"},"render")," function:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import React from 'react'\n// We're using our own custom render function and not RTL's render\n// our custom utils also re-export everything from RTL\n// so we can import fireEvent and screen here as well\nimport { render, fireEvent, screen } from '../../test-utils'\nimport App from '../../containers/App'\n\nit('Renders the connected app with initialState', () => {\n  render(<App />, { initialState: { user: 'Redux User' } })\n\n  expect(screen.getByText(/redux user/i)).toBeInTheDocument()\n})\n")),Object(o.b)("h3",{id:"middleware"},"Middleware"),Object(o.b)("p",null,"Middleware functions wrap behavior of ",Object(o.b)("inlineCode",{parentName:"p"},"dispatch")," calls in Redux, so to test this modified behavior we need to mock the behavior of the ",Object(o.b)("inlineCode",{parentName:"p"},"dispatch")," call."),Object(o.b)("h4",{id:"example-4"},"Example"),Object(o.b)("p",null,"First, we'll need a middleware function. This is similar to the real ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/gaearon/redux-thunk/blob/master/src/index.js"}),"redux-thunk"),"."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const thunk = ({ dispatch, getState }) => next => action => {\n  if (typeof action === 'function') {\n    return action(dispatch, getState)\n  }\n\n  return next(action)\n}\n")),Object(o.b)("p",null,"We need to create a fake ",Object(o.b)("inlineCode",{parentName:"p"},"getState"),", ",Object(o.b)("inlineCode",{parentName:"p"},"dispatch"),", and ",Object(o.b)("inlineCode",{parentName:"p"},"next")," functions. We use ",Object(o.b)("inlineCode",{parentName:"p"},"jest.fn()")," to create stubs, but with other test frameworks you would likely use ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://sinonjs.org/"}),"Sinon"),"."),Object(o.b)("p",null,"The invoke function runs our middleware in the same way Redux does."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const create = () => {\n  const store = {\n    getState: jest.fn(() => ({})),\n    dispatch: jest.fn()\n  }\n  const next = jest.fn()\n\n  const invoke = action => thunk(store)(next)(action)\n\n  return { store, next, invoke }\n}\n")),Object(o.b)("p",null,"We test that our middleware is calling the ",Object(o.b)("inlineCode",{parentName:"p"},"getState"),", ",Object(o.b)("inlineCode",{parentName:"p"},"dispatch"),", and ",Object(o.b)("inlineCode",{parentName:"p"},"next")," functions at the right time."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"it('passes through non-function action', () => {\n  const { next, invoke } = create()\n  const action = { type: 'TEST' }\n  invoke(action)\n  expect(next).toHaveBeenCalledWith(action)\n})\n\nit('calls the function', () => {\n  const { invoke } = create()\n  const fn = jest.fn()\n  invoke(fn)\n  expect(fn).toHaveBeenCalled()\n})\n\nit('passes dispatch and getState', () => {\n  const { store, invoke } = create()\n  invoke((dispatch, getState) => {\n    dispatch('TEST DISPATCH')\n    getState()\n  })\n  expect(store.dispatch).toHaveBeenCalledWith('TEST DISPATCH')\n  expect(store.getState).toHaveBeenCalled()\n})\n")),Object(o.b)("p",null,"In some cases, you will need to modify the ",Object(o.b)("inlineCode",{parentName:"p"},"create")," function to use different mock implementations of ",Object(o.b)("inlineCode",{parentName:"p"},"getState")," and ",Object(o.b)("inlineCode",{parentName:"p"},"next"),"."),Object(o.b)("h3",{id:"glossary"},"Glossary"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://testing-library.com/docs/react-testing-library/intro"}),"React Testing Library"),': React Testing Library is a very light-weight solution for testing React components. It provides light utility functions on top of react-dom and react-dom/test-utils, in a way that encourages better testing practices. Its primary guiding principle is: "The more your tests resemble the way your software is used, the more confidence they can give you."')),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://reactjs.org/docs/test-utils.html"}),"React Test Utils"),": ReactTestUtils makes it easy to test React components in the testing framework of your choice. React Testing Library uses the ",Object(o.b)("inlineCode",{parentName:"p"},"act")," function exported by React Test Utils."))))}d.isMDXComponent=!0},149:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),d=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},l=function(e){var t=d(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},u=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),l=d(n),u=r,m=l["".concat(c,".").concat(u)]||l[u]||b[u]||o;return n?a.a.createElement(m,s(s({ref:t},p),{},{components:n})):a.a.createElement(m,s({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,c=new Array(o);c[0]=u;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:r,c[1]=s;for(var p=2;p<o;p++)c[p]=n[p];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);